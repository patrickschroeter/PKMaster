<div id="applications">
    <div class="rel">
        <pk-loading *ngIf="!applications"></pk-loading>

        <div *ngIf="applications && !applications.length" class="empty-wrapper">
            <div class="label">No Applications here.</div>
            <pk-button icon="add" element--secondary (onClick)="overlay.toggle()" value="Create New Application" class="element--spacing-top-large"></pk-button>
        </div>

        <h1 *ngIf="applications?.length" class="element element--spacing-bottom-small">Applications</h1>
        <pk-list *ngIf="applications?.length">
            <pk-list-header>
                <!--<pk-list-attribute name="state-icon" (click)="sortBy('status')"></pk-list-attribute>-->
                <pk-list-attribute name="state" (click)="sortBy('status')">Status</pk-list-attribute>
                <pk-list-attribute name="name">Title</pk-list-attribute>
                <pk-list-attribute name="author" *accessEditApplications>Author</pk-list-attribute>
                <pk-list-attribute name="conference">Conference</pk-list-attribute>
                <pk-list-attribute name="date" (click)="sortBy('created')">Created</pk-list-attribute>
                <pk-list-attribute name="modified" (click)="sortBy('modified')">Modified</pk-list-attribute>
            </pk-list-header>
            <pk-list-content>
                <pk-list-element *ngFor="let application of applications" [name]="application.status?.name">
                    <!--<pk-list-attribute name="state-icon" [attr.tooltip]="application.status"></pk-list-attribute>-->
                    <pk-list-attribute name="state">{{ application.status?.name }}</pk-list-attribute>
                    <pk-list-attribute name="name">
                        <a routerLink="/applications/{{ application.id }}">{{ application.form ? application.form.title: 'No Form to get Title from.' }}</a>
                    </pk-list-attribute>
                    <pk-list-attribute name="author" *accessEditApplications>{{ application.user ? application.user.lastname : '' }}</pk-list-attribute>
                    <pk-list-attribute name="conference">
                        <span *accessReadConferences="1">{{ application.conference ? (application.conference.dateOfEvent | date) : ''}}</span>
                        <span *accessReadConferences>
                            <a *ngIf="application.conference" routerLink="/conferences/{{ application.conference.id }}">{{ application.conference.dateOfEvent | date  }}</a>
                        </span>
                    </pk-list-attribute>
                    <pk-list-attribute name="date">{{ application.created | date }}</pk-list-attribute>
                    <pk-list-attribute name="modified">{{ application.modified | date }}</pk-list-attribute>

                    <pk-floating horizontal top-right>
                        <pk-button rounded *ngIf="application.status?.name === 'created'" pkAlert="Submit Application"
                            (onClick)="submitApplication(application)"
                            class="element--spacing-left-tiny" icon="send" element--success></pk-button>
                        <a  *ngIf="['created', 'rescinded'].indexOf(application.status?.name) !== -1"
                            routerLink="/applications/{{ application.id }}/edit">
                            <pk-button rounded pkAlert="Edit Application" icon="create" element--secondary></pk-button>
                        </a>
                        <pk-button rounded *ngIf="['submitted'].indexOf(application.status?.name) !== -1" pkAlert="Recind Application"
                            (onClick)="rescindApplication(application)"
                            class="element--spacing-left-tiny"
                            icon="undo" element--error></pk-button>
                        <pk-button rounded *ngIf="['created', 'rescinded'].indexOf(application.status?.name) !== -1" pkAlert="Deactivate Application"
                            (onClick)="deactivateApplication(application)"
                            class="element--spacing-left-tiny"
                            icon="delete" element--error></pk-button>
                    </pk-floating>
                </pk-list-element>
            </pk-list-content>
        </pk-list>

    </div>
    <pk-floating fixed top-right *ngIf="applications?.length">
        <pk-button rounded pkAlert="Create Application" icon="add" element--secondary (onClick)="overlay.toggle()"></pk-button>
    </pk-floating>

    <pk-overlay #overlay class="overlay--fluid">
        <pk-overlay-header>
            Create New Application
        </pk-overlay-header>
        <pk-overlay-content>

            <div *ngIf="!applicationTypes?.length" class="empty-wrapper">
                <div class="label">No Forms available.</div>
                <a *accessEditForms routerLink="/forms">
                    <pk-button icon="add" element--secondary value="Create New Form" class="element--spacing-top-large"></pk-button>
                </a>
            </div>

            <div class="overlay__option selectable" *ngFor="let option of applicationTypes" (click)="createNewApplication(option)">
                    {{ option.label }}
            </div>

        </pk-overlay-content>
    </pk-overlay>
</div>
